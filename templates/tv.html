<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>TV Escolar</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #121212; color: white; overflow: hidden; height: 100vh; }
        .lado-esquerdo { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; border-right: 2px solid #333; }
        .lado-direito { height: 100vh; padding: 20px; background-color: #1e1e1e; }
        
        #nome-atual { font-size: 6rem; font-weight: bold; color: #ffc107; text-align: center; line-height: 1.1; }
        #info-atual { font-size: 3rem; margin-top: 20px; color: #ccc; }
        
        .historico-item { background: #333; margin-bottom: 10px; padding: 15px; border-radius: 10px; border-left: 5px solid #0d6efd; }
        .historico-nome { font-size: 1.5rem; font-weight: bold; }
        .historico-guiche { font-size: 1.2rem; color: #aaa; }
        
        .piscar { animation: blink 0.5s infinite alternate; }
        @keyframes blink { from { opacity: 1; } to { opacity: 0.3; } }
    </style>
</head>
<body>
    <div class="row m-0">
        <div class="col-8 lado-esquerdo">
            <h2 class="text-uppercase text-muted mb-4">Chamada Atual</h2>
            <div id="nome-atual">...</div>
            <div id="info-atual">AGUARDANDO</div>
        </div>

        <div class="col-4 lado-direito">
            <h3 class="mb-4 border-bottom pb-2">Últimos Chamados</h3>
            <div id="lista-historico">
                </div>
        </div>
    </div>

    <script>
    var socket = io();
    const synth = window.speechSynthesis;
    var vozesDisponiveis = [];

    // Carrega as vozes assim que o navegador estiver pronto
    function carregarVozes() {
        vozesDisponiveis = synth.getVoices();
    }
    
    // Alguns navegadores demoram para carregar as vozes, isso garante que carregou
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = carregarVozes;
    }

    socket.on('atualizar_tv', function(data) {
        // Atualiza visual (igual antes)
        const nomeEl = document.getElementById("nome-atual");
        document.getElementById("nome-atual").innerText = data.atual.aluno;
        document.getElementById("info-atual").innerText = "Guichê " + data.atual.guiche + " (" + data.atual.professor + ")";
        
        // Atualiza lista lateral (igual antes)
        const listaEl = document.getElementById("lista-historico");
        listaEl.innerHTML = "";
        data.historico.forEach(function(item) {
            let div = document.createElement("div");
            div.className = "historico-item";
            div.innerHTML = `<div class="historico-nome">${item.aluno}</div><div class="historico-guiche">${item.prof}</div>`;
            listaEl.appendChild(div);
        });

        // --- NOVA LÓGICA DE VOZ ---
        let texto = "Atenção " + data.atual.aluno + ". Guichê " + data.atual.guiche;
        let fala = new SpeechSynthesisUtterance(texto);
        
        // Tenta encontrar uma voz PT-BR melhor
        // 1. Procura voz do Google (geralmente mais natural)
        let vozEscolhida = vozesDisponiveis.find(v => v.name.includes('Google') && v.lang.includes('pt-BR'));
        
        // 2. Se não achar Google, tenta qualquer uma PT-BR
        if (!vozEscolhida) {
            vozEscolhida = vozesDisponiveis.find(v => v.lang.includes('pt-BR'));
        }

        if (vozEscolhida) {
            fala.voice = vozEscolhida;
        }

        fala.lang = 'pt-BR';
        fala.rate = 1.0; // Velocidade (0.5 lento, 2.0 rápido)
        fala.pitch = 1.0; // Tom da voz
        
        synth.speak(fala);
    });
</script>
</body>
</html>