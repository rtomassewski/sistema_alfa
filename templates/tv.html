<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>TV Escolar</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #121212; color: white; overflow: hidden; height: 100vh; }
        .lado-esquerdo { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; border-right: 2px solid #333; }
        .lado-direito { height: 100vh; padding: 20px; background-color: #1e1e1e; }
        
        #nome-atual { font-size: 6rem; font-weight: bold; color: #ffc107; text-align: center; line-height: 1.1; }
        #info-atual { font-size: 3rem; margin-top: 20px; color: #ccc; }
        
        .historico-item { background: #333; margin-bottom: 10px; padding: 15px; border-radius: 10px; border-left: 5px solid #0d6efd; }
        .historico-nome { font-size: 1.5rem; font-weight: bold; }
        .historico-guiche { font-size: 1.2rem; color: #aaa; }
        
        .piscar { animation: blink 0.5s infinite alternate; }
        @keyframes blink { from { opacity: 1; } to { opacity: 0.3; } }
    </style>
</head>
<body>
    <div class="row m-0">
        <div class="col-8 lado-esquerdo">
            <h2 class="text-uppercase text-muted mb-4">Chamada Atual</h2>
            <div id="nome-atual">...</div>
            <div id="info-atual">AGUARDANDO</div>
        </div>

        <div class="col-4 lado-direito">
            <h3 class="mb-4 border-bottom pb-2">Últimos Chamados</h3>
            <div id="lista-historico">
                </div>
        </div>
    </div>

    <script>
        var socket = io();
        const synth = window.speechSynthesis;

        socket.on('atualizar_tv', function(data) {
            // 1. Atualiza o Principal
            const nomeEl = document.getElementById("nome-atual");
            const infoEl = document.getElementById("info-atual");
            
            nomeEl.innerText = data.atual.aluno;
            infoEl.innerText = "Guichê " + data.atual.guiche + " (" + data.atual.professor + ")";
            
            nomeEl.classList.add("piscar");
            setTimeout(() => nomeEl.classList.remove("piscar"), 6000);

            // 2. Atualiza o Histórico (Lista Lateral)
            const listaEl = document.getElementById("lista-historico");
            listaEl.innerHTML = ""; // Limpa lista antiga
            
            // Pula o primeiro do histórico se ele for igual ao atual, ou exibe todos
            data.historico.forEach(function(item) {
                let div = document.createElement("div");
                div.className = "historico-item";
                div.innerHTML = `
                    <div class="historico-nome">${item.aluno}</div>
                    <div class="historico-guiche">${item.prof}</div>
                `;
                listaEl.appendChild(div);
            });

            // 3. Voz
            let fala = new SpeechSynthesisUtterance("Atenção " + data.atual.aluno + ". Guichê " + data.atual.guiche);
            fala.lang = 'pt-BR';
            synth.speak(fala);
        });
    </script>
</body>
</html>